<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>아이콘 에디터 - 파이프라인</title>
    <link rel="stylesheet" href="icon_editor.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>🎨 아이콘 에디터</h1>
        <p class="subtitle">파이프라인 방식으로 효과를 순차적으로 적용하세요</p>

        <div class="main-content">
            <!-- 왼쪽 패널: 업로드 & 파이프라인 -->
            <div class="left-panel">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">📁</div>
                    <p style="font-size: 14px;">이미지를 드래그하거나 클릭하여 업로드</p>
                    <p style="font-size: 11px; color: #999; margin-top: 4px;">PNG, JPG, GIF 등 모든 형식 지원</p>
                    <input type="file" id="fileInput" accept="image/*">
                </div>

                <div class="pipeline-section">
                    <div class="pipeline-header">
                        <h2>🔧 효과 파이프라인</h2>
                        <button class="add-effect-btn" id="addEffectBtn" disabled>+ 효과 추가</button>
                    </div>

                    <div class="pipeline" id="pipeline">
                        <div class="empty-pipeline">
                            <p style="font-size: 13px;">📝 효과를 추가하여 파이프라인을 구성하세요</p>
                            <p style="font-size: 11px; margin-top: 6px;">위에서 아래로 순서대로 적용됩니다</p>
                        </div>
                    </div>
                </div>

                <div class="buttons">
                    <button class="primary" id="processBtn" disabled>✨ 적용하기</button>
                    <button class="secondary" id="resetBtn" disabled>🔄 모두 제거</button>
                </div>
            </div>

            <!-- 오른쪽 패널: 미리보기 -->
            <div class="right-panel">
                <div class="preview">
                    <h2>📸 미리보기</h2>
                    <div class="preview-images">
                        <div class="preview-item">
                            <h3>원본 이미지</h3>
                            <div class="image-container">
                                <img id="originalImage" alt="원본 이미지">
                            </div>
                        </div>
                        <div class="preview-item">
                            <h3>편집 결과</h3>
                            <div class="image-container">
                                <canvas id="resultCanvas"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="buttons">
                        <button class="primary" id="downloadBtn" disabled>📥 PNG 다운로드</button>
                        <button class="secondary" id="downloadIcnsBtn" disabled>🍎 ICNS 준비 파일</button>
                    </div>

                    <div class="info" id="info"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 효과 선택 모달 -->
    <div class="modal" id="effectModal">
        <div class="modal-content">
            <h3>효과 선택</h3>
            <div class="effect-option" data-effect="padding">
                <h4>📏 내부 여백 (Padding)</h4>
                <p>이미지 크기는 유지하면서 내용물만 축소하여 중앙에 배치</p>
            </div>
            <div class="effect-option" data-effect="rounded">
                <h4>⭕ 라운드 코너 (Rounded Corners)</h4>
                <p>macOS Big Sur 스타일의 부드러운 모서리 처리</p>
            </div>
            <div class="effect-option" data-effect="invert">
                <h4>🔄 색상 반전 (Invert Colors)</h4>
                <p>RGB 색상을 반전하고 투명도는 유지 (트레이 아이콘 생성용)</p>
            </div>
            <div class="effect-option" data-effect="border">
                <h4>🖼️ 테두리 추가 (Border)</h4>
                <p>어두운 부분을 흰색으로, 검은색 테두리 추가, 투명 배경</p>
            </div>
            <button class="secondary" onclick="closeModal()" style="width: 100%; margin-top: 15px;">취소</button>
        </div>
    </div>

    <!-- ICNS 사용 방법 모달 -->
    <div class="modal" id="icnsModal">
        <div class="modal-content" style="max-width: 600px;">
            <h3>🍎 macOS ICNS 파일 생성 방법</h3>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
                <h4 style="margin-bottom: 10px; font-size: 16px;">📦 다운로드 후 실행할 명령어</h4>

                <div style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 6px; font-family: 'Monaco', 'Courier New', monospace; font-size: 13px; margin-bottom: 10px; position: relative;">
                    <code id="icnsScript" style="display: block; white-space: pre-wrap;"># ZIP 압축 해제
unzip icon.iconset.zip

# ICNS 파일 생성
iconutil -c icns icon.iconset

# 완료! icon.icns 파일이 생성되었습니다.</code>
                    <button onclick="copyScript()" style="position: absolute; top: 8px; right: 8px; background: #667eea; color: white; border: none; padding: 4px 12px; border-radius: 4px; font-size: 11px; cursor: pointer;">복사</button>
                </div>

                <p style="font-size: 12px; color: #666; margin: 0;">💡 터미널에서 다운로드 폴더로 이동 후 위 명령어를 실행하세요</p>
            </div>

            <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                <p style="font-size: 13px; margin: 0; color: #856404;">
                    <strong>⚠️ 주의:</strong> iconutil은 macOS 전용 도구입니다.<br>
                    다른 OS에서는 png_to_icns.sh 스크립트를 사용하거나 온라인 변환 도구를 이용하세요.
                </p>
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="primary" onclick="confirmIcnsDownload()" style="flex: 1; margin: 0;">📥 다운로드 시작</button>
                <button class="secondary" onclick="closeIcnsModal()" style="flex: 1; margin: 0;">취소</button>
            </div>
        </div>
    </div>

    <script src="icon_editor.js"></script>
</body>
</html>
